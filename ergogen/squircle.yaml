units:
  # Parameters
  row_spacing: 1cy

  pinky_rotation: 5 # degrees rotation relative to zone rotation
  pinky_stagger: 5 # mm, relative to previous column
  pinky_spread: 1cx # mm, relative to previous column

  ring_rotation: 3
  ring_stagger: 0.5cy
  ring_spread: 1.2cx

  middle_rotation: 0
  middle_stagger: 1
  middle_spread: 1.1cx

  index_rotation: -1
  index_stagger: -3
  index_spread: 1cx

  inner_rotation: -2
  inner_stagger: -5
  inner_spread: 1cx

  # Constants
  choc_cap_x: 17.5
  choc_cap_y: 16.5

  choc_plate_thickness: 1.2
  mx_plate_thickness: 1.5

  # demo.dxf multiplies key.width/height by this value
  visual_x: 1
  visual_y: 1

points:
  rotate: 0
  key: # each key across all zones will have these properties
    bind: 5
    width: choc_cap_x
    height: choc_cap_y
    tags:
      1u: true
    footprints: # These footprints will be added for each of the points
      choc_hotswap:
        type: choc
        nets:
          from: =key_net
          to: GND
        params:
          keycaps: true
          reverse: true
          hotswap: true
      choc:
        type: choc
        anchor:
          rotate: 180
        nets:
          from: =key_net
          to: GND
        params:
          keycaps: true
          reverse: true
  zones:
    alphas:
      rows:
        bottom.padding: row_spacing
        home.padding: row_spacing
        top.padding: row_spacing
      columns:
        pinkycluster:
          rotate: pinky_rotation
          rows:
            bottom.skip: true
            home.key_net: P113
            top.skip: true
        pinky:
          rotate: pinky_rotation - pinky_rotation
          stagger: pinky_stagger
          spread: pinky_spread
          rows:
            bottom.key_net: P110
            home.key_net: P111
            top.skip: true
        ring:
          rotate: ring_rotation - pinky_rotation
          stagger: ring_stagger
          spread: ring_spread
          rows:
            bottom.key_net: P115
            home.key_net: P003
            top.key_net: P002
        middle:
          rotate: middle_rotation - ring_rotation
          stagger: middle_stagger
          spread: middle_spread
          rows:
            bottom.key_net: P028
            home.key_net: P029
            top.key_net: P030
        index:
          rotate: index_rotation - middle_rotation
          stagger: index_stagger
          spread: index_spread
          rows:
            bottom.key_net: P031
            home.key_net: P004
            top.key_net: P005
        inner:
          rotate: inner_rotation - index_rotation
          stagger: inner_stagger
          spread: inner_spread
          rows:
            bottom.key_net: P007
            home.key_net: P109
            top.key_net: P012
    thumbkeys:
      anchor:
        ref: alphas_index_bottom
        shift: [ 0.5cx, -1cy - 2]
      columns:
        near:
          rotate: -15
          stagger: -5
          origin: [ 0, -0.5cy ]
          key.key_net: P023
        home:
          spread: 19
          stagger: 0.25cy # Move up by 0.25cy so a 1.5cy keycap lines up with the bottom
          rotate: -10 # -25 degrees cumulative
          origin: [-0.5choc_cap_y, -0.75choc_cap_x] # Pivot at the lower left corner of a 1.5u choc key
          key:
            height: 1.5choc_cap_x
            width: choc_cap_y
            tags:
              15u: true
              1u: false
            key_net: P021
            footprints.choc.anchor.rotate: 270
            footprints.choc_hotswap.anchor.rotate: 90
      rows:
        thumb:
          padding: 0
outlines:
  exports:
    _bottom_arch_circle:
      - type: circle
        radius: 500
        anchor:
          ref: alphas_middle_bottom
          shift: [-95, -522]
    _top_arch_circle:
      - type: circle
        radius: 200
        anchor:
          ref: alphas_middle_bottom
          shift: [0, -155]
    _main_body_circle:
      - type: circle
        radius: 70
        anchor:
          ref: alphas_middle_bottom
          shift: [0, 0]
    # Make a crescent by overlapping two circles then cut the main body with a third circle
    _combined: [
        +_top_arch_circle,
        -_bottom_arch_circle,
        ~_main_body_circle
    ]
    combined:
      - type: outline
        name: _combined
        fillet: 6
    switch_cutouts:
      - type: keys
        side: left
        size: 14 # Plate cutouts are 14mm * 14mm for both MX and Choc
        bound: false
    switch_plate:
      [ combined, -switch_cutouts]
    _choc_keycap_outlines:
      - type: keys
        side: left
        size: [choc_cap_x, choc_cap_y]
        bound: false
        tags: [1u]
    _choc_keycap_outlines_15u:
      - type: keys
        side: left
        size: [choc_cap_y, 1.5choc_cap_x]
        bound: false
        tags: [15u]
    keycaps_preview:
      [ _choc_keycap_outlines, _choc_keycap_outlines_15u]
cases:
  switchplate:
    - type: outline
      name: switch_plate
      extrude: choc_plate_thickness
  bottom:
    - type: outline
      name: combined
      extrude: choc_plate_thickness
pcbs:
  squircle:
    outlines:
      main:
        outline: combined
    footprints:
      mcu:
        type: holyiot
        anchor:
          ref: alphas_middle_home
          shift: [60, -18]
          rotate: 270
        nets:
          P018: RST
      reset:
        type: tactswitch
        anchor:
          ref: alphas_inner_top
          shift: [43, -10]
          rotate: 0
        nets:
          from: GND
          to: RST
      logoback:
        type: rawkicad
        params:
          data: ''
      logofront:
        type: rawkicad
        params:
          data: ''
      groundfill:
        type: rawkicad
        params:
          data: '(zone (net 2) (net_name "GND") (layers F&B.Cu) (tstamp 9f9e43f1-b8a6-44c2-ac1e-7dffea579c90) (hatch edge 0.508)
    (connect_pads (clearance 0.508))
    (min_thickness 0.254) (filled_areas_thickness no)
    (fill yes (thermal_gap 0.508) (thermal_bridge_width 0.508) (island_removal_mode 1) (island_area_min 0))
    (polygon
      (pts
        (xy 143.94 28.43)
        (xy -15.2 27.92)
        (xy -14.94 -73.73)
        (xy 144.71 -73.98)
      )
    )
    )'